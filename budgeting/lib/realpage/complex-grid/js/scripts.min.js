angular.module("rpComplexGrid",[]),angular.module("rpComplexGrid").run(["$templateCache",function(a){a.put("realpage/complex-grid/templates/grid-editable.html",'<div class="rp-cg-editable"><span class="rp-cg-text rp-cg-body-text">{{column.getVal().toLocaleString()}}</span><div class="rp-input-text small"><input class="rp-cg-input-text rp-form-input" ng-model-options="{updateOn: \'blur\'}" ng-model="column.row.data[column.config.key]"></div></div>'),a.put("realpage/complex-grid/templates/grid-headers.html",'<div class="rp-cg-headers" rp-sticky="{lockTop: 90}"><div class="rp-cg-locked rp-cg-headers-locked"><table ng-style="{width: model.getLockedWidth()}" class="rp-cg-table rp-cg-table-locked rp-cg-headers-table"><tr ng-repeat="rows in model.colHeaderGroups.rows" class="rp-cg-col-headers-group"><td ng-repeat="colHeaderGroup in rows" ng-if="colHeaderGroup.isLocked() && colHeaderGroup.isActive()" class="rp-cg-col-headers-group-cell rp-cg-cell {{::colHeaderGroup.config.classNames}} {{::colHeaderGroup.config.key.decamelize()}}" colspan="{{colHeaderGroup.config.colspan || 1}}"><span class="rp-cg-col-headers-group-text rp-cg-text">{{ colHeaderGroup.config.text }}</span></td></tr><tr ng-repeat="headers in model.rows" class="rp-cg-row rp-cg-headers-row"><td ng-repeat="header in headers" ng-style="{width: header.config.width}" colspan="{{header.config.colspan || 1}}" rowspan="{{header.config.rowspan || 1}}" ng-if="header.isLocked() && header.isActive()" class="rp-cg-cell rp-cg-headers-cell {{::header.config.classNames}} {{::header.config.key.decamelize()}}"><span ng-class="header.sort" ng-click="model.sortBy(header)" class="rp-cg-text rp-cg-headers-text">{{::header.config.text}}</span></td></tr></table></div><div class="rp-cg-free rp-cg-headers-free"><table ng-style="{width: model.getFreeWidth()}" class="rp-cg-table rp-cg-table-free rp-cg-headers-table"><tr ng-repeat="rows in model.colHeaderGroups.rows" class="rp-cg-col-headers-group"><td ng-repeat="colHeaderGroup in rows" ng-if="!colHeaderGroup.isLocked() && colHeaderGroup.isActive()" class="rp-cg-col-headers-group-cell rp-cg-cell {{::colHeaderGroup.config.classNames}} {{::colHeaderGroup.config.key.decamelize()}}" colspan="{{colHeaderGroup.config.colspan || 1}}"><span class="rp-cg-col-headers-group-text rp-cg-text">{{ colHeaderGroup.config.text }}</span></td></tr><tr ng-repeat="headers in model.rows" class="rp-cg-row rp-cg-headers-row"><td ng-repeat="header in headers" ng-style="{width: header.config.width}" colspan="{{header.config.colspan || 1}}" rowspan="{{header.config.rowspan || 1}}" ng-if="!header.isLocked() && header.isActive()" class="rp-cg-cell rp-cg-headers-cell {{::header.config.classNames}} {{::header.config.key.decamelize()}}"><span ng-class="header.sort" ng-click="model.sortBy(header)" class="rp-cg-text rp-cg-headers-text">{{::header.config.text}}</span></td></tr></table></div></div>'),a.put("realpage/complex-grid/templates/grid.html",'<div ng-class="model.state" class="rp-cg busy {{model.rowHeightClass}}"><rp-cg-headers model="model.headers"></rp-cg-headers><div class="rp-cg-body"><div class="rp-cg-locked rp-cg-body-locked"><table class="rp-cg-table" ng-style="{width: model.getLockedWidth()}"><tr ng-class="row.state" ng-click="row.toggle()" class="{{::row.classNames}}" ng-repeat="row in model.rows" ng-if="!row.state.hidden && !row.state.zeroRow"><td ng-repeat="column in row.columns" ng-style="{width: column.config.width}" class="rp-cg-cell rp-cg-body-cell {{::column.config.classNames}} {{::column.config.key.decamelize()}}" ng-if="column.isLocked() && column.isActive()"><span class="rp-cg-text rp-cg-body-text">{{column.getVal().toLocaleString()}}</span></td></tr></table></div><div class="rp-cg-free rp-cg-body-free rp-float-scroll"><table class="rp-cg-table" ng-style="{width: model.getFreeWidth()}"><tr ng-class="row.state" ng-click="row.toggle()" class="{{::row.classNames}}" ng-repeat="row in model.rows" ng-if="!row.state.hidden && !row.state.zeroRow"><td ng-repeat="column in row.columns" ng-style="{width: column.config.width}" class="rp-cg-cell rp-cg-body-cell {{::column.config.classNames}} {{::column.config.key.decamelize()}}" ng-if="!column.isLocked() && column.isActive()"><span class="rp-cg-text rp-cg-body-text">{{column.getVal().toLocaleString()}}</span></td></tr></table></div><div class="rp-cg-empty" ng-show="!model.rows.length"><div class="empty-msg" ng-bind-html="model.emptyMsg"></div></div></div></div>')}]),function(a){"use strict";function b(){return function(){var b={},c={};return b.config=c,b.getConfig=function(){return b.config},b.setRow=function(a){return b.row=a,b},b.setConfig=function(c){return a.extend(b.config,c),b},b.isLocked=function(){return b.config.state.locked},b.isActive=function(){return b.config.state.active},b.getKey=function(){return b.config.key},b.getVal=function(){return b.row.getColumnVal(b)},b.isStatic=function(){return!b.config.methodName},b.isDataColumn=function(){return!!b.config.isDataColumn},b.destroy=function(){b=void 0,c=void 0},b}}a.module("rpComplexGrid").factory("rpCgColumnModel",[b])}(angular),function(a){"use strict";function b(a,b){return function(){var c;c={open:!0,hidden:!1};var d={data:{},config:[],columns:[],state:c,classNames:"",hasConfig:!1};return d.setData=function(a){var b=a.rowType||"",c=a.rowClass||"",e=[c,"rp-cg-row","rp-cg-body-row",b.decamelize(),"level-"+a.level];return d.data=a,d.classNames=e.join(" "),d},d.setColumns=function(a){return a.getData().forEach(function(c){var e=c.key,f=b(),g=a.getConfig(e);f.setRow(d).setConfig(g),d.columns.push(f)}),d},d.extendColumns=function(a){return a.forEach(function(a,b){d.columns[b].setConfig(a)}),d},d.setFilters=function(a){return d.filters=a,d},d.setEvents=function(a){return d.events=a,d},d.setGrid=function(a){return d.grid=a,d},d.getID=function(){return d.data.rowID},d.getGroupID=function(){return d.data.groupID},d.getData=function(){return d.data},d.getLevel=function(){return d.data.level},d.getColumnVal=function(a){var b=a.getConfig();return a.isStatic()?d.data[b.key]:d.grid.getColumnVal(b,d)},d.is=function(a){return a.getID()===d.getID()},d.hasID=function(a){return d.data.rowID==a},d.hasGroupID=function(a){return d.data.groupID==a},d.isGroupHeader=function(){return"groupHeader"==d.data.rowType},d.isAggregate=function(){return"total"==d.data.rowType||"average"==d.data.rowType},d.isChildOf=function(a){return d.getLevel()==a.getLevel()+1&&d.getGroupID()!=a.getGroupID()},d.isDescOf=function(a){return d.getLevel()>a.getLevel()&&d.getGroupID()!=a.getGroupID()},d.isSiblingOf=function(a){return d.getLevel()==a.getLevel()&&d.getGroupID()==a.getGroupID()},d.isOpen=function(){return c.open},d.open=function(a){return c.open=a,d},d.show=function(a){return a=void 0===a||a,c.hidden=!a,d},d.toggle=function(){"groupHeader"==d.data.rowType&&d.events.publish(a.toggleRow,d)},d.toggleZeroRow=function(a){var b=0,c=0;d.columns.forEach(function(a){a.isDataColumn()&&(b++,0===d.data[a.getKey()]&&c++)}),d.state.zeroRow=b===c&&a},d.destroy=function(){d.columns.forEach(function(a){a.destroy()}),d=void 0,c=void 0},d}}a.module("rpComplexGrid").factory("rpCgRowModel",["rpCgEventName","rpCgColumnModel",b])}(angular),function(a){"use strict";function b(){return{resize:"resize",expRow:"expRow",colRow:"colRow",scroll:"scroll",sortBy:"sortBy",dataReady:"dataReady",toggleRow:"toggleRow",widthReady:"widthReady",updateScroll:"updateScroll"}}a.module("rpComplexGrid").factory("rpCgEventName",[b])}(angular),function(a){"use strict";function b(b,c){return function(){var d=b(),e=c(),f={src:"",emptyMsg:"No results were found.",rowConfig:{},columns:e,headers:d};return f.setHeaders=function(a){return d.setColumns(e).setConfig(a),f},f.setColHeaderGroups=function(a){return d.setColHeaderGroups(a),f},f.setColumns=function(a){return e.setData(a),f},f.setEmptyMsg=function(a){return f.emptyMsg=a,f},f.getHeaders=function(){return f.headers},f.getColumns=function(){return f.columns},f.getEmptyMsg=function(){return f.emptyMsg},f.totalWidth=function(){return e.getTotalWidth()},f.lockedWidth=function(){return e.getLockedWidth()},f.freeWidth=function(){return e.getFreeWidth()},f.maxWidth=function(){return e.getMaxWidth()},f.setSrc=function(a){return f.src=a,f},f.hasMethod=function(a){return!!f.src[a]},f.getMethod=function(b){return f.src[b]?f.src[b]:a.noop},f.setRowConfig=function(a,b){return f.rowConfig[a]=b,f},f.getRowConfig=function(a){return f.rowConfig[a]?f.rowConfig[a]:{}},f}}a.module("rpComplexGrid").factory("rpCgConfigModel",["rpCgHeadersModel","rpCgColumnsConfigModel",b])}(angular),function(a){"use strict";function b(){return function(){var a={data:[],config:{}};return a.setData=function(b){return a.data=b,b.forEach(function(b){a.config[b.key]=b}),a},a.getData=function(){return a.data},a.getConfig=function(b){return a.config[b]?a.config[b]:{}},a.getFreeWidth=function(){var b=0;return a.data.forEach(function(a){!a.state.locked&&a.state.active&&(b+=a.width)}),b},a.getTotalWidth=function(){var b=0;return a.data.forEach(function(a){a.state.active&&(b+=a.width)}),b},a.getLockedWidth=function(){var b=0;return a.data.forEach(function(a){a.state.locked&&a.state.active&&(b+=a.width)}),b},a.getMaxWidth=function(){var b=0;return a.data.forEach(function(a){b+=a.width}),b},a.destroy=function(){a=void 0},a}}a.module("rpComplexGrid").factory("rpCgColumnsConfigModel",[b])}(angular),function(a){"use strict";function b(){return function(){var b={config:{}};return b.setData=function(c){return a.extend(b.config,c),b.sort={active:!1,reverse:!1,sortable:c.isSortable},b},b.setConfig=function(c){return a.extend(b.config,c),b},b.getKey=function(){return b.config.key},b.is=function(a){return b.getKey()==a.getKey()},b.isLocked=function(){return b.config.state.locked},b.isActive=function(){return b.config.state.active},b.isSortable=function(){return!!b.config.isSortable},b.sortBy=function(a){a&&!b.sort.active?b.sort.active=!0:a&&b.sort.active?b.sort.reverse=!b.sort.reverse:(b.sort.active=!1,b.sort.reverse=!1)},b.getSortDir=function(){return b.sort.reverse},b.destroy=function(){b=void 0},b}}a.module("rpComplexGrid").factory("rpCgHeaderModel",[b])}(angular),function(a){"use strict";function b(a,b,c){return function(){var d={rows:[],colHeaderGroups:b()};return d.getFreeWidth=function(){return d.columns.getFreeWidth()},d.getLockedWidth=function(){return d.columns.getLockedWidth()},d.setEvents=function(a){return d.events=a,d},d.setColumns=function(a){return d.columns=a,d},d.setColHeaderGroups=function(a){return d.colHeaderGroups.setColHeaderGroups(a)},d.sortBy=function(a){a.isSortable()&&d.rows.forEach(function(b){b.forEach(function(b){var e=b.is(a);b.sortBy(e),e&&d.events.publish(c.sortBy,b)})})},d.setConfig=function(b){b.forEach(function(b){var c=[];b.forEach(function(b){var e=b.key,f=d.columns.getConfig(e),g=a().setData(b);c.push(g.setConfig(f))}),d.rows.push(c)})},d.subscribe=function(){return d.events.subscribe.apply(d.events,arguments)},d.publish=function(){return d.events.publish.apply(d.events,arguments)},d.destroy=function(){d.colHeaderGroups.destroy(),d.rows.forEach(function(a){a.forEach(function(a){a.destroy()})}),d=void 0},d}}a.module("rpComplexGrid").factory("rpCgHeadersModel",["rpCgHeaderModel","rpCgHeadersGroupModel","rpCgEventName",b])}(angular),function(a){"use strict";function b(){return function(){var b={config:{}};return b.setData=function(c){return a.extend(b.config,c),b},b.isLocked=function(){return b.config.state.locked},b.isActive=function(){return b.config.state.active},b.destroy=function(){b=void 0},b}}a.module("rpComplexGrid").factory("rpCgHeaderGroupModel",[b])}(angular),function(a){"use strict";function b(a){return function(){var b={rows:[]};return b.setColHeaderGroups=function(c){return c.forEach(function(c){var d=[];c.forEach(function(b){var c=a().setData(b);d.push(c)}),b.rows.push(d)}),b},b.destroy=function(){b.rows.forEach(function(a){a.forEach(function(a){a.destroy()})}),b=void 0},b}}a.module("rpComplexGrid").factory("rpCgHeadersGroupModel",["rpCgHeaderGroupModel",b])}(angular),function(a){"use strict";function b(a){function b(b,c,d){var e,f={};f.init=function(){b.model&&(e=b.model,b.rpCgHeaders=f,e.subscribe(a.resize,f.onResize),f.destWatch=b.$on("$destroy",f.destroy))},f.onResize=function(a){c.width(a.availWidth)},f.destroy=function(){f.destWatch(),e=void 0},f.init()}return{scope:{model:"="},link:b,restrict:"E",replace:!0,templateUrl:"realpage/complex-grid/templates/grid-headers.html"}}a.module("rpComplexGrid").directive("rpCgHeaders",["rpCgEventName",b])}(angular),function(a){"use strict";function b(a){function b(b,c,d){var e,f={};f.init=function(){b.model&&(e=b.model,e.subscribe(a.resize,f.setSize),e.subscribe(a.scroll,f.onScroll),f.destWatch=b.$on("$destroy",f.destroy),b.rpCgHeadersFree=f)},f.onScroll=function(a){c.scrollLeft(a)},f.setSize=function(a){c.width(a.availWidth-a.lockedWidth)},f.destroy=function(){f.destWatch(),e=void 0},f.init()}return{link:b,restrict:"C"}}a.module("rpComplexGrid").directive("rpCgHeadersFree",["rpCgEventName",b])}(angular),function(a){"use strict";function b(b,c,d){function e(e,f,g){var h,i={};i.init=function(){i.visible=!1,e.rpCgOptions=i,i.grid=b(g.targetGrid)(e),i.destWatch=e.$on("$destroy",i.destroy)},i.body=function(){return h=h||a.element("body")},i.toggle=function(){i.visible=!i.visible,i.visible?c(i.bind):i.body().off("click.rpCgOptions")},i.bind=function(){i.body().on("click.rpCgOptions",i.hide)},i.hide=function(){e.$apply(function(){i.visible=!1}),i.body().off("click.rpCgOptions")},i.updateLayout=function(){i.grid.publish(d.dataReady)},i.destroy=function(){i.destWatch(),i.visible=!1},i.init()}return{link:e,restrict:"C"}}a.module("rpComplexGrid").directive("rpCgOptions",["$parse","timeout","rpCgEventName",b])}(angular),function(a){"use strict";function b(b,c){function d(d,e,f){var g={};g.init=function(){g.config=d.column.config,g.config.templateUrl&&g.assembleChild().appendChild(),d.rpCgBodyCell=g,d.$on("$destroy",g.destroy)},g.assembleChild=function(){var e=g.config.templateUrl,f=b.get(e),h=a.element(f);return g.child=c(h)(d),g},g.appendChild=function(){e.children().remove(),e.append(g.child)},g.destroy=function(){g.config.templateUrl&&g.child.remove(),g.config=void 0},g.init()}return{link:d,restrict:"C"}}a.module("rpComplexGrid").directive("rpCgBodyCell",["$templateCache","$compile",b])}(angular),function(a){"use strict";function b(){var b={};b.currency=function(a){return a=parseFloat(a,10),"$"+a.toLocaleString()};var c={filters:b};return c.register=function(a,b){return c.filters[a]=b,c},c.hasFilter=function(a){return!!c.filters[a]},c.getFilter=function(a){return c.filters[a]},c.extendFilters=function(b){return a.extend(c.filters,b),c},c}a.module("rpComplexGrid").factory("rpCgFilters",[b])}(angular),function(a){"use strict";function b(a){return function(b,c){return a.hasFilter(c)?a.getFilter(c)(b):b}}a.module("rpComplexGrid").filter("rpCgFilter",["rpCgFilters",b])}(angular),function(a){"use strict";function b(a){function b(b,c,d){var e,f={};f.init=function(){e=b.model,b.rpCgBodyFree=f,c.on("scroll",f.onScroll),e.subscribe(a.resize,f.onResize),f.destWatch=b.$on("$destroy",f.destroy)},f.onScroll=function(){e.publish(a.scroll,c.scrollLeft())},f.onResize=function(a){c.width(a.availWidth-a.lockedWidth)},f.destroy=function(){f.destWatch(),e=void 0},f.init()}return{link:b,restrict:"C"}}a.module("rpComplexGrid").directive("rpCgBodyFree",["rpCgEventName",b])}(angular),function(a){"use strict";function b(a,b,c){function d(d,e,f){var g,h={maxWidthSet:!1};h.init=function(){d.rpCg=h,g=d.model;var a=g.subscribe;a(b.dataReady,h.setWidth),a(b.updateScroll,h.updateScroll),h.destWatch=d.$on("$destroy",h.destroy),h.resizeWatch=c.subscribe(h.setWidth)},h.removeBusy=function(){e.removeClass("busy")},h.updateScroll=function(){a(d.floatScroll.setSize,10)},h.calcWidth=function(){var a=e.parent().width(),b=g.getTotalWidth(),c=g.getLockedWidth();return a=a>b?b:a,{availWidth:a,lockedWidth:c}},h.setWidth=function(){var c=h.calcWidth();h.maxWidthSet||(h.maxWidthSet=!0,e.css("maxWidth",g.getTotalWidth())),h.updateScroll(),a(h.removeBusy,10),g.publish(b.resize,c)},h.destroy=function(){h.destWatch(),h.resizeWatch(),g=void 0},h.init()}return{scope:{model:"="},link:d,restrict:"E",replace:!0,templateUrl:"realpage/complex-grid/templates/grid.html"}}a.module("rpComplexGrid").directive("rpCg",["timeout","rpCgEventName","windowSize",b])}(angular),function(a){"use strict";function b(b,c,d,e,f,g){return function(){var h={},i=d(),j=Object.keys(e),k={rows:[],state:h,rowHeightClass:"large",events:i.setEvents(j)};return k.init=function(){return i.subscribe(e.sortBy,k.sortBy),i.subscribe(e.toggleRow,k.toggleRow),k},k.edit=function(a){return a=void 0===a||a,h.edit=a,k},k.format=function(a,b){return g.hasFilter(b)?g.getFilter(b)(a):a},k.sortBy=function(a){var c,d=[],e=[],f=b("orderBy"),g=a.getSortDir(),h="data."+a.getKey();k.rows.forEach(function(a,b){var i=a.isAggregate(),j=a.isGroupHeader(),l=c!=a.getGroupID();if(l||j||i){if(c=a.getGroupID(),d.empty()||(d=f(d,h,g),e=e.concat(d),d=[]),j||i)return void e.push(a);d.push(a)}else d.push(a);b!=k.rows.length-1||d.empty()||(d=f(d,h,g),e=e.concat(d),d=[])}),k.rows=e},k.toggleRow=function(a){if(a.isGroupHeader()){var b=!0,c=a.isOpen();a.open(!c),k.rows.forEach(function(d){if(d.is(a))return void(b=!1);if(!b){var e=d.isDescOf(a),f=d.isChildOf(a),g=d.isSiblingOf(a),h=d.isGroupHeader();c&&(g||e)?(d.show(!1),h&&d.open(!1)):(g||f&&h)&&d.show(),g||e||(b=!0)}}),k.publish(e.updateScroll)}},k.forEachRow=function(a){return k.rows.forEach(a),k},k.setConfig=function(a){return k.gridConfig=a,k.headers=a.getHeaders(),k.columns=a.getColumns(),k.emptyMsg=a.getEmptyMsg(),k.headers.setEvents(k.events),k},k.saveChanges=function(){return k.gridDataCopy=a.copy(k.gridData),k},k.flushChanges=function(){return k.setData(k.gridDataCopy),k},k.setData=function(b){return k.gridData=b,k.gridDataCopy=a.copy(b),k.rows.flush(),b.forEach(function(a){var b=a.rowType,c=f().setGrid(k),d=k.gridConfig.getColumns();if(c.setData(a).setEvents(i).setColumns(d),b){var e=k.gridConfig.getRowConfig(b);c.extendColumns(e)}k.rows.push(c)}),c(function(){i.publish(e.dataReady)}),k},k.subscribe=function(){return i.subscribe.apply(i,arguments)},k.publish=function(){return i.publish.apply(i,arguments)},k.getColumnVal=function(b,c){var d=b.methodName,e=k.gridConfig.getMethod,f=["getAverage","getTotal"],g=f.contains(d),h=k.gridConfig.hasMethod(d),i=h?e(d):a.noop;return(i=g?k[d]:a.noop)(b,c,k.gridData)},k.getTotal=function(a,b,c){var d=0;return k.rows.forEach(function(c){c.isGroupHeader()||c.isAggregate()||(c.isSiblingOf(b)||c.isDescOf(b))&&(d+=parseInt(c.getData()[a.key],10))}),d},k.getAverage=function(a,b,c){},k.getTotalWidth=function(){return k.gridConfig.totalWidth()},k.getFreeWidth=function(){return k.gridConfig.freeWidth()},k.getLockedWidth=function(){return k.gridConfig.lockedWidth()},k.getMaxWidth=function(){return k.gridConfig.maxWidth()},k.toggleZeroRows=function(a){k.rows.forEach(function(b){b.toggleZeroRow(a)})},k.destroy=function(){i.destroy(),k=void 0,i=void 0},k.init()}}a.module("rpComplexGrid").factory("rpCgModel",["$filter","$timeout","eventsManager","rpCgEventName","rpCgRowModel","rpCgFilters",b])}(angular);
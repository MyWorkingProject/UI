!function(a,b){"use strict";a.module("smart-table",[]).run(["$templateCache",function(a){a.put("template/smart-table/pagination.html",'<div class="pull-left margin-right-24 form-control-label">Displaying {{((stItemsByPage * currentPage) - stItemsByPage) + 1}} - {{stItemsByPage * currentPage}} of {{stItemsByPage * numPages}}</div><nav class="pull-left" ng-if="pages.length >= 2"><ul class="pagination"><li><a ng-click="selectPage(1)"><span class="font-12 rp-icon-angle-double-left"></span></a></li><li><a ng-click="selectPage(currentPage - 1)"><span class="font-12 rp-icon-angle-left"></span></a></li><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li><li><a ng-click="selectPage(currentPage + 1)"><span class="font-12 rp-icon-angle-right"></span></a></li><li><a ng-click="selectPage(numPages)"><span class="font-12 rp-icon-angle-double-right"></span></a></li></ul></nav>')}]),a.module("smart-table").constant("stConfig",{pagination:{template:"template/smart-table/pagination.html",itemsByPage:10,displayedPages:5},search:{delay:400},select:{mode:"single",selectedClass:"st-selected"},sort:{ascentClass:"st-sort-ascent",descentClass:"st-sort-descent"}}),a.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function(c,d,e,f){function g(a){return a?[].concat(a):[]}function h(){q=g(i(c)),s===!0&&t.pipe()}var i,j,k,l=f.stTable,m=d(l),n=m.assign,o=e("orderBy"),p=e("filter"),q=g(m(c)),r={sort:{},search:{},pagination:{start:0}},s=!0,t=this;f.stSafeSrc&&(i=d(f.stSafeSrc),c.$watch(function(){var a=i(c);return a?a.length:0},function(a,b){a!==q.length&&h()}),c.$watch(function(){return i(c)},function(a,b){a!==b&&h()})),this.sortBy=function(b,c){return r.sort.predicate=b,r.sort.reverse=c===!0,a.isFunction(b)?r.sort.functionName=b.name:delete r.sort.functionName,r.pagination.start=0,this.pipe()},this.search=function(b,c){var d=r.search.predicateObject||{},e=c?c:"$";return b=a.isString(b)?b.trim():b,d[e]=b,b||delete d[e],r.search.predicateObject=d,r.pagination.start=0,this.pipe()},this.pipe=function(){var a,d=r.pagination;j=r.search.predicateObject?p(q,r.search.predicateObject):q,r.sort.predicate&&(j=o(j,r.sort.predicate,r.sort.reverse)),d.number!==b&&(d.numberOfPages=j.length>0?Math.ceil(j.length/d.number):1,d.start=d.start>=j.length?(d.numberOfPages-1)*d.number:d.start,a=j.slice(d.start,d.start+parseInt(d.number))),n(c,a||j)},this.select=function(a,c){var d=q,e=d.indexOf(a);e!==-1&&("single"===c?(a.isSelected=a.isSelected!==!0,k&&(k.isSelected=!1),k=a.isSelected===!0?a:b):d[e].isSelected=!d[e].isSelected)},this.slice=function(a,b){return r.pagination.start=a,r.pagination.number=b,this.pipe()},this.tableState=function(){return r},this.getFilteredCollection=function(){return j||q},this.setFilterFunction=function(a){p=e(a)},this.setSortFunction=function(a){o=e(a)},this.preventPipeOnWatch=function(){s=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(a,b,c,d){c.stSetFilter&&d.setFilterFunction(c.stSetFilter),c.stSetSort&&d.setSortFunction(c.stSetSort)}}}),a.module("smart-table").directive("stSearch",["stConfig","$timeout",function(a,b){return{require:"^stTable",scope:{predicate:"=?stSearch"},link:function(c,d,e,f){var g=f,h=null,i=e.stDelay||a.search.delay;c.$watch("predicate",function(a,b){a!==b&&(f.tableState().search={},g.search(d[0].value||"",a))}),c.$watch(function(){return f.tableState().search},function(a,b){var e=c.predicate||"$";a.predicateObject&&a.predicateObject[e]!==d[0].value&&(d[0].value=a.predicateObject[e]||"")},!0),d.bind("input",function(a){a=a.originalEvent||a,null!==h&&b.cancel(h),h=b(function(){g.search(a.target.value,c.predicate||""),h=null},i)})}}}]),a.module("smart-table").directive("stSelectRow",["stConfig",function(a){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(b,c,d,e){var f=d.stSelectMode||a.select.mode;c.bind("click",function(){b.$apply(function(){e.select(b.row,f)})}),b.$watch("row.isSelected",function(b){b===!0?c.addClass(a.select.selectedClass):c.removeClass(a.select.selectedClass)})}}}]),a.module("smart-table").directive("stSort",["stConfig","$parse",function(c,d){return{restrict:"A",require:"^stTable",link:function(e,f,g,h){function i(){m++,k=a.isFunction(l(e))?l(e):g.stSort,m%3===0&&g.stSkipNatural===b?(m=0,h.tableState().sort={},h.tableState().pagination.start=0,h.pipe()):h.sortBy(k,m%2===0)}var j,k=g.stSort,l=d(k),m=0,n=g.stClassAscent||c.sort.ascentClass,o=g.stClassDescent||c.sort.descentClass,p=[n,o];g.stSortDefault&&(j=e.$eval(g.stSortDefault)!==b?e.$eval(g.stSortDefault):g.stSortDefault),f.bind("click",function(){k&&e.$apply(i)}),j&&(m="reverse"===j?1:0,i()),e.$watch(function(){return h.tableState().sort},function(a){a.predicate!==k?(m=0,f.removeClass(n).removeClass(o)):(m=a.reverse===!0?2:1,f.removeClass(p[m%2]).addClass(p[m-1]))},!0)}}}]),a.module("smart-table").directive("stPagination",["stConfig",function(a){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(b,c){return c.stTemplate?c.stTemplate:a.pagination.template},link:function(b,c,d,e){function f(){var a,c,d=e.tableState().pagination,f=1,g=b.currentPage;for(b.currentPage=Math.floor(d.start/d.number)+1,f=Math.max(f,b.currentPage-Math.abs(Math.floor(b.stDisplayedPages/2))),a=f+b.stDisplayedPages,a>d.numberOfPages&&(a=d.numberOfPages+1,f=Math.max(1,a-b.stDisplayedPages)),b.pages=[],b.numPages=d.numberOfPages,c=f;c<a;c++)b.pages.push(c);g!==b.currentPage&&b.stPageChange({newPage:b.currentPage})}b.stItemsByPage=b.stItemsByPage?+b.stItemsByPage:a.pagination.itemsByPage,b.stDisplayedPages=b.stDisplayedPages?+b.stDisplayedPages:a.pagination.displayedPages,b.currentPage=1,b.pages=[],b.$watch(function(){return e.tableState().pagination},f,!0),b.$watch("stItemsByPage",function(a,c){a!==c&&b.selectPage(1)}),b.$watch("stDisplayedPages",f),b.selectPage=function(a){a>0&&a<=b.numPages&&e.slice((a-1)*b.stItemsByPage,b.stItemsByPage)},e.tableState().pagination.number||e.slice(0,b.stItemsByPage)}}}]),a.module("smart-table").directive("stPipe",function(){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(b,c,d,e){a.isFunction(b.stPipe)&&(e.preventPipeOnWatch(),e.pipe=function(){return b.stPipe(e.tableState(),e)})},post:function(a,b,c,d){d.pipe()}}}})}(angular);